import{e as O,s as D,r as s,o as l,h as _,w as r,b as i,C as j,d,c,F as f,l as w,t as p,J as E,K as J,L as A,a as k,k as L,I as U,A as m,H as x,m as $}from"./j--dK8i6.js";const q=1e3,M={__name:"StripePayment",setup(H){const C=O(),{getIsAuthenticated:y,getUser:V}=D(C),u=s(!0),P=s(null),v=s(""),n=s(""),a=s(!1),I=s(null),N=s([]),b=s([]),S=s([]),g=s([]),h=async()=>{const t=await(await fetch("/api/get-all-products",{method:"POST"})).json();if(N.value=t.products.map(e=>e.id),!u.value||!P.value){n.value="Stripe has not loaded yet. Please try again.";return}a.value=!0,n.value="";try{const{error:e}=await u.value.confirmPayment({elements:P.value,confirmParams:{return_url:`${window.location.origin}/payment-success?payment_intent=${I.value}`,payment_method_data:{billing_details:{name:v.value}}}});if(e)throw new Error(e.message)}catch(e){n.value=e.message}finally{a.value=!1}},T=async()=>{const t=await(await fetch("/api/get-products-by-id",{method:"POST",body:JSON.stringify({productsID:b.value})})).json();b.value=t.products.map(e=>e.id),S.value=t.products.map(e=>e.name),g.value=t.products.map(e=>e.default_price)},B=async()=>{const t=await(await fetch("/api/stripe-payment-checkout-session",{method:"POST",body:JSON.stringify({default_price:g.value})})).json();window.location=t.url},F=async()=>{if(!y.value){n.value="Please log in to subscribe.";return}try{const o=await fetch("/api/stripe-subscription-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:V.value.uid})});if(!o.ok)throw new Error("Failed to create checkout session");const t=await o.json();window.location=t.url}catch(o){console.error("Error creating subscription:",o),n.value="Failed to create subscription. Please try again."}};return(o,t)=>(l(),_($,{class:"max-w-md mx-auto mt-8 p-6 bg-white shadow-lg rounded-lg"},{default:r(()=>[i(j,{class:"text-2xl font-bold mb-4"},{default:r(()=>t[1]||(t[1]=[d(" Checkout ")])),_:1}),(l(!0),c(f,null,w(b.value,e=>(l(),c("p",{key:e}," Product ID: "+p(e),1))),128)),i(E,{onSubmit:J(h,["prevent"])},{default:r(()=>[i(A,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),label:"Name on Card",required:"",outlined:"",class:"mb-4"},null,8,["modelValue"]),t[4]||(t[4]=k("div",{id:"payment-element"},null,-1)),n.value?(l(),_(L,{key:0,type:"error",class:"mb-16"},{default:r(()=>[d(p(n.value),1)]),_:1})):U("",!0),i(m,{type:"submit",color:"primary",loading:a.value,disabled:!u.value||a.value,block:"","x-large":"",class:"mt-4",onClick:h},{default:r(()=>[d(" Pay £"+p((q/100).toFixed(2)),1)]),_:1},8,["loading","disabled"]),(l(!0),c(f,null,w(g.value,e=>(l(),c("div",{key:e},[k("p",null,"Pay: £"+p(e),1)]))),128)),(l(!0),c(f,null,w(S.value,e=>(l(),c("div",{key:e},[k("p",null,"Product Name: "+p(e),1)]))),128)),i(m,{type:"submit",color:"primary",loading:a.value,disabled:!u.value||a.value,block:"","x-large":"",class:"mt-4",onClick:T},{default:r(()=>t[2]||(t[2]=[d(" get Products By Id Post ")])),_:1},8,["loading","disabled"]),i(m,{type:"submit",color:"primary",loading:a.value,disabled:!u.value||a.value,block:"","x-large":"",class:"mt-4",onClick:B},{default:r(()=>t[3]||(t[3]=[d(" payment ")])),_:1},8,["loading","disabled"]),i(m,{type:"submit",color:"primary",loading:a.value,disabled:!u.value||a.value||!x(y),block:"","x-large":"",class:"mt-4",onClick:F},{default:r(()=>[d(p(x(y)?"Subscribe":"Log in to Subscribe"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1}))}};export{M as _};
//# sourceMappingURL=XABny-ev.js.map
