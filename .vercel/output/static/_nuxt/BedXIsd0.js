import{_ as J,S as K,R as z,e as H,s as Q,r as t,G as X,f as Z,b3 as ee,o as c,c as w,a as g,t as k,I as y,b as i,L as b,F as ae,w as v,d,M as se,A as V,h as F,K as le,T as N,an as T,b4 as B,U as te,W as oe,Y as re}from"./j--dK8i6.js";import{p as C}from"./BbcqoxRw.js";const ie={class:"auth-form"},ne={class:"text-h3"},ue={key:0,class:"error"},de={key:1,class:"info"},me={__name:"FirebaseAuthentication",props:{initialMode:{type:String,default:"signup",validator:S=>["signup","login"].includes(S)}},emits:["close"],setup(S,{emit:M}){const I=S,O=M,A=K(),E=z(),m=A.$firebaseAuth,u=H();Q(u);const r=t(I.initialMode==="signup"),R=t(!1),o=t(""),n=t(""),x=t(""),U=t(""),h=t(""),l=t(""),p=t(""),f=t(""),P=t(!1),_=X(()=>r.value?o.value&&n.value&&h.value&&!p.value&&!f.value&&P.value:o.value&&n.value&&!p.value&&!f.value),q=()=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;p.value=s.test(o.value)?"":"Please enter a valid email address"},L=()=>{f.value=n.value.length>=6?"":"Password must be at least 6 characters long"},D=async()=>{try{r.value?await $():await j(),l.value=""}catch(s){l.value=C(s)}},$=async()=>{const e=await(await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o.value,password:n.value,name:x.value,number:h.value,school:U.value})})).json();if(e.success){const a=await N(m,o.value,n.value);await T(a.user),alert("A verification email has been sent. Please check your inbox and verify your email before logging in."),await B(m),E.push("/verify-email"),u.setUser({...e.user,uid:a.user.uid,email:a.user.email})}else throw new Error(e.message)},j=async()=>{const e=(await N(m,o.value,n.value)).user;if(!e.emailVerified){l.value="Please verify your email before logging in.",u.setEmailVerified(!1),await T(e),E.push("/verify-email");return}const a=await te(oe(A.$firestore,"users",e.uid));a.exists()?u.setUser({...a.data(),uid:e.uid,email:e.email,emailVerified:e.emailVerified}):u.setUser({uid:e.uid,email:e.email,emailVerified:e.emailVerified})},W=async()=>{try{await B(m),u.clearUser(),l.value="",O("close")}catch(s){l.value=C(s)}},Y=async()=>{if(!o.value){l.value="Please enter your email address.";return}try{await re(m,o.value),l.value="Password reset email sent. Please check your inbox."}catch(s){l.value=C(s)}},G=()=>{r.value=!r.value,l.value="",p.value="",f.value=""};return Z(()=>{const s=ee(m,e=>{u.setUser(e)});return()=>s()}),(s,e)=>(c(),w("div",ie,[g("h1",ne,k(r.value?"Sign Up":"Login"),1),l.value?(c(),w("p",ue,k(l.value),1)):y("",!0),R.value?(c(),w("p",de," A verification email has been sent. Please check your inbox and verify your email before logging in. ")):y("",!0),g("form",{onSubmit:le(D,["prevent"])},[i(b,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),label:"Email",type:"email",required:"","error-messages":p.value,onBlur:q},null,8,["modelValue","error-messages"]),i(b,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),label:"Password",type:"password",required:"","error-messages":f.value,onBlur:L},null,8,["modelValue","error-messages"]),r.value?(c(),w(ae,{key:0},[i(b,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=a=>x.value=a),label:"Full Name",type:"text"},null,8,["modelValue"]),i(b,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),label:"Phone Number",type:"tel",required:""},null,8,["modelValue"]),i(b,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=a=>U.value=a),label:"School (optional)",type:"text"},null,8,["modelValue"]),i(se,{modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=a=>P.value=a),rules:[a=>!!a||"You must agree to continue!"],required:""},{label:v(()=>e[6]||(e[6]=[g("span",{class:"text-caption"},[d(" I agree to the "),g("a",{href:"/terms-and-conditions",target:"_blank"},"Terms of Use"),d(" and "),g("a",{href:"/privacy-policy",target:"_blank"},"Privacy Policy")],-1)])),_:1},8,["modelValue","rules"])],64)):y("",!0),i(V,{type:"submit",disabled:!_.value,color:"primary",block:""},{default:v(()=>[d(k(r.value?"Sign Up":"Login"),1)]),_:1},8,["disabled"]),r.value?y("",!0):(c(),F(V,{key:1,text:"",class:"mt-2",onClick:Y},{default:v(()=>e[7]||(e[7]=[d(" Forgot Password ")])),_:1}))],32),i(V,{text:"",class:"mt-4",onClick:G},{default:v(()=>[d(k(r.value?"Already a member? Login":"Not a member? Sign Up"),1)]),_:1}),s.user?(c(),F(V,{key:2,color:"error",class:"mt-4",onClick:W},{default:v(()=>e[8]||(e[8]=[d(" Sign Out ")])),_:1})):y("",!0),i(V,{text:"",class:"mt-4",onClick:s.handleCancel},{default:v(()=>e[9]||(e[9]=[d(" Cancel ")])),_:1},8,["onClick"])]))}},pe=J(me,[["__scopeId","data-v-48e8c9a3"]]);export{pe as F};
//# sourceMappingURL=BedXIsd0.js.map
